server {
    listen 443 ssl;
    listen [::]:443 ssl;

    server_name jellyfin-fra.nkdekker.nl;

    include /config/nginx/ssl.conf;

    allow 24.132.0.0/17; # Ziggo Services B.V.
    allow 24.132.128.0/17; # Ziggo Services B.V.
    allow 31.20.0.0/15; # Odido Netherlands B.V.
    allow 31.149.0.0/16; # KPN B.V.
    allow 31.151.0.0/16; # Ziggo Services B.V.
    allow 31.160.0.0/15; # KPN B.V.
    allow 31.184.64.0/18; # Odido Netherlands B.V.
    allow 31.187.128.0/17; # Odido Netherlands B.V.
    allow 37.74.0.0/16; # KPN B.V.
    allow 37.188.64.0/20; # KPN B.V.
    allow 37.251.0.0/17; # KPN B.V.
    allow 46.129.0.0/16; # Ziggo Services B.V.
    allow 46.144.0.0/15; # KPN B.V.
    allow 62.12.0.0/19; # KPN B.V.
    allow 62.21.128.0/17; # KPN B.V.
    allow 62.25.0.0/18; # KPN B.V.
    allow 62.41.112.0/20; # KPN B.V.
    allow 62.41.128.0/19; # KPN B.V.
    allow 62.41.176.0/20; # KPN B.V.
    allow 62.41.192.0/18; # KPN B.V.
    allow 62.45.0.0/17; # DELTA Fiber Nederland B.V.
    allow 62.45.128.0/17; # DELTA Fiber Nederland B.V.
    allow 62.58.0.0/15; # Odido Netherlands B.V.
    allow 62.100.0.0/19; # Ziggo Services B.V.
    allow 62.100.32.0/19; # Ziggo Services B.V.
    allow 62.108.0.0/19; # Ziggo Services B.V.
    allow 62.131.0.0/16; # KPN B.V.
    allow 62.132.48.0/20; # KPN B.V.
    allow 62.132.64.0/19; # KPN B.V.
    allow 62.132.96.0/20; # KPN B.V.
    allow 62.132.144.0/20; # KPN B.V.
    allow 62.132.160.0/19; # KPN B.V.
    allow 62.132.192.0/18; # KPN B.V.
    allow 62.133.64.0/18; # KPN B.V.
    allow 62.145.192.0/18; # Ziggo B.V.
    allow 62.163.0.0/16; # Ziggo Services B.V.
    allow 62.166.0.0/16; # Odido Netherlands B.V.
    allow 62.177.128.0/19; # Odido Netherlands B.V.
    allow 62.177.160.0/19; # Odido Netherlands B.V.
    allow 62.177.192.0/18; # Odido Netherlands B.V.
    allow 62.194.0.0/15; # Ziggo Services B.V.
    allow 62.207.0.0/16; # KPN B.V.
    allow 62.216.0.0/19; # KPN B.V.
    allow 62.238.0.0/16; # DELTA Fiber Nederland B.V.
    allow 62.250.0.0/16; # Odido Netherlands B.V.
    allow 62.251.0.0/17; # KPN B.V.
    allow 77.60.0.0/14; # KPN B.V.
    allow 77.160.0.0/12; # KPN B.V.
    allow 77.245.80.0/20; # KPN B.V.
    allow 77.248.0.0/14; # Ziggo Services B.V.
    allow 78.27.0.0/18; # Odido Netherlands B.V.
    allow 80.56.0.0/15; # Ziggo Services B.V.
    allow 80.60.0.0/15; # KPN B.V.
    allow 80.79.96.0/20; # KPN B.V.
    allow 80.85.32.0/20; # Ziggo Services B.V.
    allow 80.100.0.0/15; # KPN B.V.
    allow 80.112.0.0/17; # Ziggo B.V.
    allow 80.112.128.0/18; # Ziggo B.V.
    allow 80.113.0.0/16; # Ziggo Services B.V.
    allow 80.114.0.0/17; # Ziggo B.V.
    allow 80.114.128.0/18; # Ziggo B.V.
    allow 80.114.192.0/18; # Ziggo B.V.
    allow 80.115.0.0/17; # Ziggo B.V.
    allow 80.115.128.0/18; # Ziggo B.V.
    allow 80.115.224.0/19; # Ziggo B.V.
    allow 80.126.0.0/15; # KPN B.V.
    allow 80.242.224.0/20; # Ziggo B.V.
    allow 80.242.240.0/20; # Ziggo B.V.
    allow 80.246.176.0/20; # KPN B.V.
    allow 80.248.32.0/20; # Ziggo Services B.V.
    allow 81.18.240.0/20; # Odido Netherlands B.V.
    allow 81.24.48.0/20; # KPN B.V.
    allow 81.58.0.0/15; # Odido Netherlands B.V.
    allow 81.172.128.0/17; # DELTA Fiber Nederland B.V.
    allow 81.175.64.0/18; # Ziggo Services B.V.
    allow 81.204.0.0/14; # KPN B.V.
    allow 82.72.0.0/14; # Ziggo B.V.
    allow 82.92.0.0/14; # KPN B.V.
    allow 82.101.192.0/18; # Ziggo B.V.
    allow 82.136.192.0/18; # KPN B.V.
    allow 82.139.64.0/18; # KPN B.V.
    allow 82.151.160.0/19; # Ziggo B.V.
    allow 82.161.0.0/16; # KPN B.V.
    allow 82.168.0.0/14; # KPN B.V.
    allow 82.172.0.0/14; # Odido Netherlands B.V.
    allow 82.176.0.0/16; # DELTA Fiber Nederland B.V.
    allow 82.201.0.0/17; # KPN B.V.
    allow 82.204.0.0/17; # Odido Netherlands B.V.
    allow 82.215.0.0/18; # Odido Netherlands B.V.
    allow 82.217.0.0/16; # Ziggo B.V.
    allow 83.68.0.0/19; # KPN B.V.
    allow 83.80.0.0/13; # Ziggo B.V.
    allow 83.98.224.0/19; # DELTA Fiber Nederland B.V.
    allow 83.128.0.0/16; # DELTA Fiber Nederland B.V.
    allow 83.160.0.0/14; # KPN B.V.
    allow 83.219.64.0/19; # KPN B.V.
    allow 83.232.0.0/16; # KPN B.V.
    allow 84.24.0.0/13; # Ziggo B.V.
    allow 84.39.0.0/19; # KPN B.V.
    allow 84.41.128.0/17; # Ziggo Services B.V.
    allow 84.80.0.0/13; # KPN B.V.
    allow 84.104.0.0/14; # Ziggo B.V.
    allow 84.241.192.0/18; # Odido Netherlands B.V.
    allow 85.113.224.0/19; # KPN B.V.
    allow 85.147.0.0/16; # Ziggo B.V.
    allow 85.223.0.0/17; # Odido Netherlands B.V.
    allow 86.80.0.0/12; # KPN B.V.
    allow 87.99.128.0/17; # DELTA Fiber Nederland B.V.
    allow 87.208.0.0/13; # Odido Netherlands B.V.
    allow 87.250.128.0/19; # KPN B.V.
    allow 88.159.0.0/16; # KPN B.V.
    allow 88.211.128.0/18; # Ziggo Services B.V.
    allow 89.98.0.0/15; # Ziggo Services B.V.
    allow 89.200.0.0/17; # KPN B.V.
    allow 89.205.128.0/17; # Odido Netherlands B.V.
    allow 89.220.0.0/17; # Ziggo Services B.V.
    allow 89.220.128.0/17; # Ziggo B.V.
    allow 91.141.128.0/17; # Odido Netherlands B.V.
    allow 92.64.0.0/14; # KPN B.V.
    allow 92.68.0.0/15; # KPN B.V.
    allow 92.70.0.0/16; # KPN B.V.
    allow 92.71.192.0/18; # KPN B.V.
    allow 92.108.0.0/14; # Ziggo Services B.V.
    allow 92.254.0.0/17; # Odido Netherlands B.V.
    allow 93.125.128.0/17; # Odido Netherlands B.V.
    allow 93.154.0.0/17; # KPN B.V.
    allow 94.157.0.0/16; # Odido Netherlands B.V.
    allow 94.208.0.0/13; # Ziggo B.V.
    allow 94.229.48.0/20; # KPN B.V.
    allow 95.36.0.0/16; # Odido Netherlands B.V.
    allow 95.96.0.0/15; # Ziggo Services B.V.
    allow 95.98.0.0/15; # Odido Netherlands B.V.
    allow 95.152.128.0/18; # KPN B.V.
    allow 109.72.32.0/20; # KPN B.V.
    allow 109.109.96.0/19; # DELTA Fiber Nederland B.V.
    allow 128.127.32.0/20; # KPN B.V.
    allow 136.143.0.0/17; # DELTA Fiber Nederland B.V.
    allow 141.105.0.0/20; # KPN B.V.
    allow 178.84.0.0/15; # Ziggo Services B.V.
    allow 178.224.0.0/13; # Odido Netherlands B.V.
    allow 188.88.0.0/14; # Odido Netherlands B.V.
    allow 188.142.0.0/17; # KPN B.V.
    allow 188.200.0.0/13; # KPN B.V.
    allow 193.91.48.0/20; # KPN B.V.
    allow 193.141.144.0/20; # KPN B.V.
    allow 193.141.160.0/20; # KPN B.V.
    allow 193.141.240.0/20; # KPN B.V.
    allow 193.172.0.0/16; # KPN B.V.
    allow 193.173.0.0/16; # KPN B.V.
    allow 194.45.240.0/20; # KPN B.V.
    allow 194.109.0.0/16; # KPN B.V.
    allow 194.120.64.0/20; # KPN B.V.
    allow 194.121.128.0/19; # KPN B.V.
    allow 194.121.176.0/20; # KPN B.V.
    allow 194.121.224.0/20; # KPN B.V.
    allow 194.122.0.0/18; # KPN B.V.
    allow 194.122.96.0/20; # KPN B.V.
    allow 194.122.128.0/18; # KPN B.V.
    allow 194.122.192.0/19; # KPN B.V.
    allow 194.123.0.0/18; # KPN B.V.
    allow 194.123.64.0/19; # KPN B.V.
    allow 194.123.96.0/20; # KPN B.V.
    allow 194.123.128.0/19; # KPN B.V.
    allow 194.123.176.0/20; # KPN B.V.
    allow 194.123.192.0/18; # KPN B.V.
    allow 194.151.0.0/16; # KPN B.V.
    allow 195.7.128.0/19; # KPN B.V.
    allow 195.18.64.0/18; # Ziggo Services B.V.
    allow 195.35.128.0/18; # Ziggo B.V.
    allow 195.35.192.0/18; # Ziggo B.V.
    allow 195.64.64.0/20; # KPN B.V.
    allow 195.64.80.0/20; # KPN B.V.
    allow 195.73.0.0/16; # KPN B.V.
    allow 195.85.128.0/19; # Ziggo B.V.
    allow 195.85.160.0/19; # Ziggo B.V.
    allow 195.121.0.0/16; # KPN B.V.
    allow 195.240.0.0/19; # KPN B.V.
    allow 195.240.32.0/19; # KPN B.V.
    allow 195.240.64.0/18; # KPN B.V.
    allow 195.240.128.0/17; # KPN B.V.
    allow 195.241.0.0/16; # KPN B.V.
    allow 204.168.128.0/17; # DELTA Fiber Nederland B.V.
    allow 212.53.16.0/20; # Odido Netherlands B.V.
    allow 212.54.32.0/19; # Ziggo B.V.
    allow 212.67.160.0/19; # Ziggo Services B.V.
    allow 212.83.64.0/19; # Ziggo Services B.V.
    allow 212.84.0.0/19; # KPN B.V.
    allow 212.92.64.0/19; # DELTA Fiber Nederland B.V.
    allow 212.115.192.0/19; # DELTA Fiber Nederland B.V.
    allow 212.120.64.0/18; # Ziggo B.V.
    allow 212.123.128.0/19; # KPN B.V.
    allow 212.123.160.0/19; # KPN B.V.
    allow 212.127.128.0/17; # Ziggo B.V.
    allow 212.142.0.0/18; # Ziggo Services B.V.
    allow 212.178.32.0/19; # Ziggo Services B.V.
    allow 212.178.64.0/18; # Ziggo B.V.
    allow 212.178.128.0/19; # Ziggo B.V.
    allow 212.178.192.0/19; # Ziggo B.V.
    allow 212.182.128.0/19; # KPN B.V.
    allow 212.182.160.0/19; # KPN B.V.
    allow 212.187.0.0/17; # Ziggo Services B.V.
    allow 212.203.0.0/19; # Ziggo B.V.
    allow 212.204.128.0/18; # Ziggo B.V.
    allow 212.204.192.0/19; # KPN B.V.
    allow 212.204.224.0/19; # KPN B.V.
    allow 212.238.0.0/16; # KPN B.V.
    allow 212.241.32.0/19; # KPN B.V.
    allow 213.10.0.0/16; # KPN B.V.
    allow 213.34.0.0/19; # Ziggo Services B.V.
    allow 213.34.64.0/19; # Ziggo B.V.
    allow 213.34.96.0/19; # Ziggo B.V.
    allow 213.34.160.0/19; # Ziggo B.V.
    allow 213.34.224.0/19; # DELTA Fiber Nederland B.V.
    allow 213.46.0.0/16; # Ziggo Services B.V.
    allow 213.51.0.0/16; # Ziggo B.V.
    allow 213.73.128.0/17; # Ziggo B.V.
    allow 213.75.0.0/16; # KPN B.V.
    allow 213.84.0.0/16; # KPN B.V.
    allow 213.93.0.0/16; # Ziggo Services B.V.
    allow 213.124.0.0/18; # Ziggo B.V.
    allow 213.124.64.0/18; # Ziggo B.V.
    allow 213.124.128.0/19; # Ziggo B.V.
    allow 213.124.160.0/19; # Ziggo Services B.V.
    allow 213.124.192.0/18; # Ziggo Services B.V.
    allow 213.125.0.0/17; # Ziggo B.V.
    allow 213.125.128.0/18; # Ziggo B.V.
    allow 213.125.192.0/18; # Ziggo B.V.
    allow 213.126.0.0/18; # Ziggo B.V.
    allow 213.126.64.0/19; # Ziggo B.V.
    allow 213.126.96.0/19; # Ziggo B.V.
    allow 213.126.128.0/17; # Ziggo Services B.V.
    allow 213.127.0.0/16; # Ziggo Services B.V.
    allow 213.130.160.0/19; # KPN B.V.
    allow 213.132.160.0/19; # Ziggo B.V.
    allow 213.133.32.0/19; # KPN B.V.
    allow 213.148.224.0/19; # KPN B.V.
    allow 213.160.192.0/19; # Ziggo Services B.V.
    allow 213.184.96.0/19; # DELTA Fiber Nederland B.V.
    allow 213.197.0.0/18; # KPN B.V.
    allow 213.197.192.0/18; # KPN B.V.
    allow 213.206.64.0/18; # KPN B.V.
    allow 213.222.0.0/19; # KPN B.V.
    allow 217.16.32.0/20; # Odido Netherlands B.V.
    allow 217.17.128.0/20; # Ziggo Services B.V.
    allow 217.26.96.0/20; # KPN B.V.
    allow 217.62.0.0/16; # Ziggo B.V.
    allow 217.63.0.0/18; # Ziggo B.V.
    allow 217.63.64.0/19; # DELTA Fiber Nederland B.V.
    allow 217.63.128.0/18; # Ziggo Services B.V.
    allow 217.63.192.0/18; # Ziggo B.V.
    allow 217.100.0.0/17; # Ziggo B.V.
    allow 217.100.128.0/18; # Ziggo B.V.
    allow 217.100.192.0/18; # Ziggo B.V.
    allow 217.101.0.0/16; # Ziggo B.V.
    allow 217.102.0.0/17; # Ziggo Services B.V.
    allow 217.102.128.0/18; # Ziggo B.V.
    allow 217.102.192.0/19; # Ziggo B.V.
    allow 217.102.224.0/20; # Ziggo B.V.
    allow 217.102.240.0/20; # DELTA Fiber Nederland B.V.
    allow 217.103.0.0/16; # Ziggo Services B.V.
    allow 217.104.0.0/17; # Ziggo B.V.
    allow 217.104.128.0/17; # Ziggo Services B.V.
    allow 217.105.0.0/18; # Ziggo Services B.V.
    allow 217.105.64.0/18; # Ziggo B.V.
    allow 217.105.128.0/18; # Ziggo B.V.
    allow 217.105.192.0/19; # Ziggo B.V.
    allow 217.105.224.0/19; # Ziggo Services B.V.
    allow 217.112.112.0/20; # Ziggo Services B.V.
    allow 217.115.192.0/20; # KPN B.V.
    allow 217.120.0.0/14; # Ziggo B.V.
    allow 217.148.80.0/20; # KPN B.V.
    allow 217.149.64.0/20; # KPN B.V.
    allow 217.149.192.0/20; # Odido Netherlands B.V.
    allow 217.149.208.0/20; # Odido Netherlands B.V.
    allow 217.166.0.0/16; # KPN B.V.
    allow 217.194.96.0/20; # KPN B.V.
    allow 217.194.112.0/20; # KPN B.V.
    allow 109.32.0.0/13; # Vodafone Libertel B.V.
    allow 192.168.1.0/24; # LAN
    deny all;

    client_max_body_size 0;

    location / {
        include /config/nginx/proxy.conf;
        resolver 127.0.0.11 valid=30s;
        set $upstream_app jellyfin;
        set $upstream_port 8096;
        set $upstream_proto http;
        proxy_pass $upstream_proto://$upstream_app:$upstream_port;

        proxy_set_header Range $http_range;
        proxy_set_header If-Range $http_if_range;
    }

    location ~ (/jellyfin)?/socket/ {
        include /config/nginx/proxy.conf;
        resolver 127.0.0.11 valid=30s;
        set $upstream_app jellyfin;
        set $upstream_port 8096;
        set $upstream_proto http;
        proxy_pass $upstream_proto://$upstream_app:$upstream_port;

        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
   }
}